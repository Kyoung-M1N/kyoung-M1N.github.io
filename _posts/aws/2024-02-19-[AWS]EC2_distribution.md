---
title: EC2로 서버 배포
author: kymin
date: 2024-02-19 17:41
categories: [Aws]
tags: [aws, spring, database]

---

## Amazon EC2(Amazon Elastic Compute Cloud)?

EC2는 아마존 웹 서비스(AWS)가 제공하는 클라우드 컴퓨팅 서비스를 말하며 사용자는 EC2를 통해 아마존이 구축한 데이터센터의 서버용 컴퓨터의 자원을 원격으로 사용할 수 있다.

운영체제와 메모리, CPU, 저장공간 등을 필요에 따라 구성할 수 있으며 적은 비용 또는 무료로 가상 서버를 구축하여 애플리케이션을 쉽고 빠르게 배포할 수 있다.

AWS에서는 가상 머신을 통해 사용자에게 제공하는 물리적인 컴퓨터 인프라를 인스턴스라고 한다.

## EC2 인스턴스 생성

AWS 웹사이트에 접속하여 회원가입 및 로그인 후에 EC2 인스턴스 생성 메뉴에 들어가서 생성을 시작한다.

아래의 항목들에서 설정값을 선택한 뒤 인스턴스 시작 버튼을 클릭하여 인스턴스를 생성한다.

### 이름 및 태그

생성할 EC2 인스턴스의 이름을 설정하거나 태그를 추가하여 인스턴스에 대한 자세한 설명을 작성한다.

### 애플리케이션 및 OS 이미지

사용하려는 OS를 선택하고 선택한 OS에 해당하는 AMI를 선택한다.

> AMI(Amazon Machine Image)?
>
> AMI는 인스턴스를 구성할 때 필요한 정보가 담긴 일종의 템플릿으로 운영체제의 버전이나 OS와 함께 설치될 소프트웨어 패키지에 대한 내용을 포함한다.

### 인스턴스 유형

인스턴스 유형은 생성할 인스턴스에 대한 CPU성능과 메모리 용량에 대한 설정값으로 CPU성능과 메모리 용량에 따라 요금이 달라진다.

프리티어를 사용하기 위해서는 t2.micro를 선택해야한다.

### 키 페어(로그인)

EC2 인스턴스에 접속하기 위한 키 페어를 생성 또는 선택하는 항목이다.

이미 키 페어를 가지고 있다면 기존의 키 페어를 선택 가능하며, 키 페어를 새로 생성할 때에는 원하는 원격 접속 방법(OpenSSH, Putty)과 암호화 방식을 선택하여 생성할 수 있다.

### 네트워크 설정

퍼블릭 IP와 방화벽(보안 그룹), 트래픽 허용 여부 등에 대해 설정하는 항목으로 특별히 따로 설정이 필요한 항목이 없다면 기본값을 사용해도 된다.

보안 그룹의 경우에는 인스턴스 생성 후에 따로 수정하거나 새로운 보안 그룹을 생성하여 EC2 인스턴스에 적용할 수 있다.

### 스토리지 구성

저장 공간에 대한 설정값으로 프리티어의 경우 최대 30GiB의 용량을 사용할 수 있으며 SSD나 HDD등 옵션도 조정 가능하다.

## EC2 인스턴스 삭제

EC2 인스턴스는 계정 당 12개월에 한하여 사용시간이 월 750시간 이하일 경우 무료로 이용 가능하지만 인스턴스를 여러 개 생성할 경우 사용시간이 인스턴스의 수만큼 늘어나게 되어 비용이 청구될 수 있다. 따라서 사용하지 않는 인스턴스는 사용을 중지하거나 삭제하는 것이 좋다.

인스턴스의 삭제는 AWS 웹사이트의 서비스 탭에서 EC2를 선택한 뒤에 사이드 바의 인스턴스를 클릭하여 인스턴스 항목에서 삭제할 인스턴스를 체크한 뒤에 인스턴스 상태를 종료로 설정하면 된다.(항목에서 삭제될 때까지는 최소 반나절 정도 걸린다.)

## 보안 그룹 생성

보안 그룹 EC2 인스턴스에 보내는 요청의 허용 여부를 관리하는 가상 방화벽으로 인바운드 규칙과 아웃바운드 규칙으로 구성된다.

EC2 인스턴스에서 주고받을 요청의 프로토콜 유형과 IP주소, 포트 등을 설정할 수 있다.

### 인바운드 규칙

외부에서 EC2 인스턴스로의 요청을 의미한다.

외부의 서버와 통신을 필요로하거나 외부 DB에 접근하여 데이터를 주고 받아야 하는 경우 해당 프로토콜에 대한 설정을 추가해주면 된다.

### 아웃바운드 규칙

EC2 인스턴스에서 외부로의 요청을 의미하며 기본적으로 모든 프로토콜과 주소에 대해 허용되도록 설정되어있다.

### 보안 그룹  적용

EC2 인스턴스 대시보드로 이동하여 보안 그룹을 변경하려는 인스턴스 체크 후 작업탭에서 보안 그룹 변경을 선택하고 기존에 있던 default보안 그룹 제거 후 적용하려는 보안그룹 추가한 뒤 저장한다.

## EC2로 서버 배포

EC2 인스턴스에서 소프트웨어가 동작하기 위해서는 인스턴스가 실행파일의 동작을 위한 환경이 구성되어있어야 하며, 인스턴스에 실행파일이 존재해야한다.

EC2 인스턴스에 실행파일을 만들기 위한 방법으로는 프로젝트 디렉토리를 EC2로 가져와 빌드하는 방법과 외부에서 빌드된 파일을 EC2로 전송하는 방법이 있다.

### EC2 인스턴스에 접속 후 환경 설정

인스턴스 생성 시 다운로드 된 sshKey.pem가 있는 경로로 이동하여 `chmod 400 sshKey.pem`명령어로 읽기 권한을 축소한다.

인스턴스의 퍼블릭 DNS를 참조하여 `ssh -i "sshKey.pem" [퍼블릭 IPv4 DNS]`) 명령어로 EC2 인스턴스에 접속한다.

`sudo apt-get update`명령어를 통해 apt를 업데이트 한 뒤 git(`sudo apt-get install git`)과 자바(`sudo get-apt install openjdk-17-jdk`)를 설치한다.

### 배포할 파일 이동 후 빌드

배포 파일을 EC2 인스턴스로 가져오기 위한 방법은 2가지가 있다.

- EC2에 `git clone` 후 빌드

  아래의 명령어를 통해 git ssh key를 생성

  ```shell
  cd ~/.ssh
  ssh-keygen -t rsa -C github 메일(example@github.com)
  ```

  `cat id_rsa.pub`명령어로 id_rsa.pub파일의 내용을 출력 한 뒤에 github -> setting -> SSH and GPG keys 탭으로 이동 후 ssh key를 생성(미리 출력한 id_rsa.pub파일의 내용을 복사하여 key에 붙여넣기)

  EC2 인스턴스에서 배포 파일이 있는 repository를 clone한 뒤에 빌드 실행

- `scp`명령어를 통해 로컬에서 EC2 인스턴스로 파일 전송

  배포할 프로젝트를 빌드한 뒤에 압축한 후 아래의 명령어를 통해 EC2 인스턴스로 파일 전송

  ```shell
  scp -i sshKey.pem 파일이름.zip ubuntu@[주소]:[디렉토리 위치]
  ```

  `unzip [파일 이름].zip -d [디렉토리 위치]`명령어를 통해 원하는 위치에 빌드한 배포파일을 압축 해제

### 배포 파일 실행

배포 파일이 있는 위치로 이동하여 아래의 명령어를 통해 실행

```shell
java -jar [실행 파일 이름].jar
```

또는 아래의 명령어를 통해 백그라운드에서 파일을 실행

```shell
nohup java -jar [실행 파일 이름].jar &
// & : 프로세스를 백그라운드에서 동작하도록 만드는 옵션
```

---

##### 참고자료 :

[https://velog.io/@jonghyun3668](https://velog.io/@jonghyun3668/SpringBoot-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-EC2-%EB%B0%B0%ED%8F%AC%ED%95%98%EA%B8%B0)

[https://dev-chw.tistory.com/26](https://dev-chw.tistory.com/26)

[https://lucas-owner.tistory.com](https://lucas-owner.tistory.com/44)

[https://velog.io/@kyj311](https://velog.io/@kyj311/AWS-EC2-%EC%95%8C%EC%95%84%EB%B3%B4%EA%B8%B0)